<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
  <meta charset="UTF-8">
  <title>Gráficos - StudyBuddy</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<!-- Navbar -->
<th:block th:replace="fragments/navbar :: navbar(active=${active}, usuario=${usuario})"></th:block>

<div class="container mt-5">
  <h2 class="mb-4">Estadísticas de Grupos</h2>
  <div class="row">
    <div class="col-md-4">
      <canvas id="barChart"></canvas>
    </div>
    <div class="col-md-4">
      <canvas id="pieChart"></canvas>
    </div>
    <div class="col-md-4">
      <canvas id="lineChart"></canvas>
    </div>
  </div>
</div>

<script th:inline="javascript">
/*<![CDATA[*/
var grupos = /*[[${grupos}]]*/ [];
var usuarios = /*[[${usuarios}]]*/ [];
var labels = grupos.map(g => g.nombre);
var dataMiembros = grupos.map(g => g.miembros);

// Datos para gráfico de preferencias de estudio
var preferenciasData = {};
usuarios.forEach(usuario => {
  if (usuario.preferenciasEstudio) {
    usuario.preferenciasEstudio.forEach(pref => {
      preferenciasData[pref] = (preferenciasData[pref] || 0) + 1;
    });
  }
});

var preferenciasLabels = Object.keys(preferenciasData);
var preferenciasValues = Object.values(preferenciasData);

// Datos para gráfico de materias
var materiasData = {};
usuarios.forEach(usuario => {
  if (usuario.materias) {
    usuario.materias.forEach(materia => {
      materiasData[materia] = (materiasData[materia] || 0) + 1;
    });
  }
});

var materiasLabels = Object.keys(materiasData);
var materiasValues = Object.values(materiasData);
/*]]>*/
</script>

<script>
// Gráfico de barras - Estudiantes por materia
new Chart(document.getElementById('barChart'), {
  type: 'bar',
  data: {
    labels: materiasLabels,
    datasets: [{
      label: 'Estudiantes por Materia',
      data: materiasValues,
      backgroundColor: 'rgba(13, 110, 253, 0.7)',
      borderColor: 'rgba(13, 110, 253, 1)',
      borderWidth: 1
    }]
  },
  options: {
    responsive: true,
    plugins: {
      title: {
        display: true,
        text: 'Estudiantes por Materia'
      }
    }
  }
});

// Gráfico circular - Preferencias de estudio
new Chart(document.getElementById('pieChart'), {
  type: 'pie',
  data: {
    labels: preferenciasLabels,
    datasets: [{
      data: preferenciasValues,
      backgroundColor: ['#0d6efd','#198754','#ffc107','#dc3545','#6f42c1','#fd7e14']
    }]
  },
  options: {
    responsive: true,
    plugins: {
      title: {
        display: true,
        text: 'Preferencias de Estudio'
      }
    }
  }
});

// Gráfico lineal
new Chart(document.getElementById('lineChart'), {
  type: 'line',
  data: {
    labels: labels,
    datasets: [{
      label: 'Crecimiento de miembros',
      data: dataMiembros,
      borderColor: 'rgba(255,99,132,1)',
      backgroundColor: 'rgba(255,99,132,0.2)',
      fill: true,
      tension: 0.2
    }]
  },
  options: {
    responsive: true,
    plugins: {
      legend: { display: true, position: 'top' }
    }
  }
});
</script>
</body>
</html>
